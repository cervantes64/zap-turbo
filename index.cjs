'use strict';var a0_0x2947f7=a0_0x2ae1;(function(_0x262924,_0x56d61e){var _0x15c896=a0_0x2ae1,_0x4bf49d=_0x262924();while(!![]){try{var _0x49ee95=parseInt(_0x15c896(0x1c6))/0x1*(-parseInt(_0x15c896(0x170))/0x2)+parseInt(_0x15c896(0x1c8))/0x3+parseInt(_0x15c896(0x1ab))/0x4*(parseInt(_0x15c896(0x19e))/0x5)+-parseInt(_0x15c896(0x174))/0x6+-parseInt(_0x15c896(0x18e))/0x7+parseInt(_0x15c896(0x18a))/0x8*(parseInt(_0x15c896(0x197))/0x9)+parseInt(_0x15c896(0x198))/0xa;if(_0x49ee95===_0x56d61e)break;else _0x4bf49d['push'](_0x4bf49d['shift']());}catch(_0x1f2b12){_0x4bf49d['push'](_0x4bf49d['shift']());}}}(a0_0xb2c3,0x761eb));var __create=Object[a0_0x2947f7(0x175)],__defProp=Object[a0_0x2947f7(0x14a)],__getOwnPropDesc=Object[a0_0x2947f7(0x184)],__getOwnPropNames=Object[a0_0x2947f7(0x16e)],__getProtoOf=Object[a0_0x2947f7(0x196)],__hasOwnProp=Object['prototype'][a0_0x2947f7(0x152)],__copyProps=(_0x21d742,_0x391d98,_0x427d4e,_0x583040)=>{var _0x247723=a0_0x2947f7;if(_0x391d98&&typeof _0x391d98==='object'||typeof _0x391d98===_0x247723(0x18d)){for(let _0x359d5a of __getOwnPropNames(_0x391d98))if(!__hasOwnProp['call'](_0x21d742,_0x359d5a)&&_0x359d5a!==_0x427d4e)__defProp(_0x21d742,_0x359d5a,{'get':()=>_0x391d98[_0x359d5a],'enumerable':!(_0x583040=__getOwnPropDesc(_0x391d98,_0x359d5a))||_0x583040[_0x247723(0x1a9)]});}return _0x21d742;},__toESM=(_0x460843,_0x397988,_0x4c8874)=>(_0x4c8874=_0x460843!=null?__create(__getProtoOf(_0x460843)):{},__copyProps(_0x397988||!_0x460843||!_0x460843[a0_0x2947f7(0x1ae)]?__defProp(_0x4c8874,a0_0x2947f7(0x161),{'value':_0x460843,'enumerable':!![]}):_0x4c8874,_0x460843)),import_wppconnect=__toESM(require(a0_0x2947f7(0x16b)),0x1);async function delay(_0x4ff457){return await new Promise(_0x378062=>setTimeout(_0x378062,_0x4ff457));}var import_node=require(a0_0x2947f7(0x162)),allLastMessagesMap=new Map();function isValidMessage(_0x39d7ac){var _0x55b440=a0_0x2947f7;return!_0x39d7ac[_0x55b440(0x18f)]&&_0x39d7ac[_0x55b440(0x1b8)]!=='status@broadcast';}async function sendMessagesWithDelay({messages:_0x48b00c,client:_0x46d0db,targetNumber:_0x45adad,activeChatsHistory:_0x3d89c6,currentMessage:_0x1591d5,excludedNumbersIntervention:_0x1baec5}){var _0x2a353f=a0_0x2947f7;for(const [_0x7323a8,_0x5525aa]of _0x48b00c['entries']()){await delay(0x1f4);const _0x210d3c=await _0x46d0db[_0x2a353f(0x1b4)](_0x45adad,{'count':0x5,'direction':_0x2a353f(0x177),'fromMe':!![]});!allLastMessagesMap['has'](_0x45adad)&&allLastMessagesMap[_0x2a353f(0x165)](_0x45adad,[]);let _0x411394=allLastMessagesMap[_0x2a353f(0x178)](_0x45adad);const _0x2cf75c=_0x210d3c['filter'](_0x5e4ba3=>!_0x411394['some'](_0x43fcd2=>_0x43fcd2['id']===_0x5e4ba3['id']));_0x411394=[..._0x2cf75c,..._0x411394][_0x2a353f(0x158)]((_0x5dde61,_0x4ff810)=>_0x5dde61[_0x2a353f(0x1b5)]-_0x4ff810['timestamp'])[_0x2a353f(0x190)](0x0,0x32),allLastMessagesMap['set'](_0x45adad,_0x411394);const _0x1d5d2e=await isMissingMessages({'activeChatsHistory':_0x3d89c6,'chatId':_0x45adad,'lastMessages':_0x411394});if(_0x1d5d2e){console[_0x2a353f(0x1a7)]('Há\x20mensagens\x20enviadas\x20por\x20humanos\x20na\x20conversa,\x20parando\x20automação...'),_0x1baec5[_0x2a353f(0x165)](_0x45adad,!![]),setTimeout(()=>{_0x1baec5['has'](_0x45adad)&&_0x1baec5['delete'](_0x45adad);},Number(process[_0x2a353f(0x15f)][_0x2a353f(0x17e)])*0x3c*0x3c*0x3e8);return;}await _0x46d0db['startTyping'](_0x45adad);const _0x5b0f4f=_0x5525aa['length']*0x64;await new Promise(_0x453d57=>setTimeout(_0x453d57,_0x5b0f4f)),_0x46d0db[_0x2a353f(0x1ad)](_0x45adad,_0x5525aa[_0x2a353f(0x1a6)]()[_0x2a353f(0x16c)]())[_0x2a353f(0x1c1)](async _0x395e0a=>{var _0x6384aa=_0x2a353f;console[_0x6384aa(0x1a7)](_0x6384aa(0x14c),_0x395e0a['body']);if(_0x3d89c6['has'](_0x45adad)){const _0x4c183b=_0x3d89c6[_0x6384aa(0x178)](_0x45adad);_0x7323a8===_0x48b00c[_0x6384aa(0x16a)]-0x1?_0x3d89c6[_0x6384aa(0x165)](_0x45adad,[..._0x4c183b,{'role':'user','parts':_0x1591d5},{'role':_0x6384aa(0x15e),'parts':_0x5525aa[_0x6384aa(0x1a6)]()[_0x6384aa(0x16c)]()}]):_0x3d89c6[_0x6384aa(0x165)](_0x45adad,[..._0x4c183b,{'role':'model','parts':_0x5525aa[_0x6384aa(0x1a6)]()['trimEnd']()}]);}else _0x3d89c6[_0x6384aa(0x165)](_0x45adad,[{'role':'user','parts':_0x1591d5},{'role':'model','parts':_0x5525aa[_0x6384aa(0x1a6)]()[_0x6384aa(0x16c)]()}]),setTimeout(()=>{var _0x8a563b=_0x6384aa;_0x3d89c6[_0x8a563b(0x1a4)](_0x45adad)&&(_0x3d89c6[_0x8a563b(0x1ca)](_0x45adad),console[_0x8a563b(0x1a7)]('A\x20IA\x20voltará\x20a\x20responder:\x20'+_0x45adad+'.'));},0x48*0x3c*0x3c*0x3e8);await _0x46d0db[_0x6384aa(0x17a)](_0x45adad);})[_0x2a353f(0x1b9)](_0x44235c=>{var _0x99cced=_0x2a353f;console['error'](_0x99cced(0x1a8),_0x44235c),(0x0,import_node[_0x99cced(0x153)])(_0x44235c);});}}async function isMissingMessages({chatId:_0x59c5f8,activeChatsHistory:_0x396f57,lastMessages:_0xffa535}){var _0x20bd3f=a0_0x2947f7;const _0x388345=_0x396f57[_0x20bd3f(0x178)](_0x59c5f8);if(!_0x388345||_0x388345[_0x20bd3f(0x16a)]===0x0)return![];const _0x231f15=_0x388345[_0x20bd3f(0x173)](_0x415540=>_0x415540[_0x20bd3f(0x1bf)]===_0x20bd3f(0x15e))[_0x20bd3f(0x183)]();if(!_0x231f15)return![];const _0x5d0188=_0xffa535[_0x20bd3f(0x1a0)](_0x19710f=>_0x19710f[_0x20bd3f(0x185)]===_0x231f15['parts']&&_0x19710f[_0x20bd3f(0x15c)]);if(_0x5d0188===-0x1)return![];const _0x3ea850=_0xffa535[_0x20bd3f(0x190)](_0x5d0188)['filter'](_0x4b0ab8=>_0x4b0ab8[_0x20bd3f(0x15c)])['find'](_0x179318=>{var _0x422e78=_0x20bd3f;const _0xd91d5=_0x388345[_0x422e78(0x173)](_0x2a9857=>_0x2a9857[_0x422e78(0x1bf)]==='model')[_0x422e78(0x193)](_0x1c601f=>{var _0x47fc5a=_0x422e78;return _0x1c601f[_0x47fc5a(0x1d0)]===_0x179318[_0x47fc5a(0x185)];});if(_0xd91d5)return![];return!![];});return!!_0x3ea850;}async function sendTextOnce({client:_0x3abcd0,chatId:_0x55b457,message:_0x30ee32,lastSentMessageWarningByChatId:_0x1c16a9}){var _0x24183c=a0_0x2947f7;_0x1c16a9['get'](_0x55b457)!==_0x30ee32&&(console[_0x24183c(0x1a7)](_0x24183c(0x19a),_0x30ee32),await _0x3abcd0['sendText'](_0x55b457,_0x30ee32),_0x1c16a9[_0x24183c(0x165)](_0x55b457,_0x30ee32));}function splitMessages(_0x559717){var _0x566fcf=a0_0x2947f7;const _0x29b0c9=/(http[s]?:\/\/[^\s]+)|(www\.[^\s]+)|([^\s]+@[^\s]+\.[^\s]+)|(["'].*?["'])|(\b\d+\.\s)|(\w+\.\w+)/g,_0x459f98=_0x559717[_0x566fcf(0x14f)](_0x29b0c9)??[],_0xa22345=_0x566fcf(0x15d);let _0x50b477=0x0;const _0x4d6a2c=_0x559717[_0x566fcf(0x160)](_0x29b0c9,()=>''+_0xa22345+_0x50b477++),_0x4330af=/(?<!\b\d+\.\s)(?<!\w+\.\w+)[^.?!]+(?:[.?!]+["']?|$)/g;let _0x5b4436=_0x4d6a2c['match'](_0x4330af)??[];return _0x459f98[_0x566fcf(0x16a)]>0x0&&(_0x5b4436=_0x5b4436[_0x566fcf(0x1be)](_0x208d70=>_0x459f98[_0x566fcf(0x1c5)]((_0x17a9dd,_0x34f63a,_0x165794)=>_0x17a9dd[_0x566fcf(0x160)](''+_0xa22345+_0x165794,_0x34f63a),_0x208d70))),_0x5b4436;}function registerMessageOnHistory({chatId:_0x4edcc4,message:_0x4fa032,activeChatsHistory:_0x2fa561}){var _0x2941f1=a0_0x2947f7;if(_0x2fa561['has'](_0x4edcc4)){const _0x282149=_0x2fa561['get'](_0x4edcc4);_0x2fa561[_0x2941f1(0x165)](_0x4edcc4,[..._0x282149,{'role':'model','parts':_0x4fa032}]);}else _0x2fa561[_0x2941f1(0x165)](_0x4edcc4,[{'role':_0x2941f1(0x15e),'parts':_0x4fa032}]);}var import_generative_ai=require('@google/generative-ai'),import_dotenv=__toESM(require(a0_0x2947f7(0x1a3)),0x1);import_dotenv['default']['config']();function a0_0xb2c3(){var _0x5cd573=['openai','Há\x20mensagens\x20enviadas\x20por\x20humanos\x20na\x20conversa,\x20parando\x20automação\x20para\x20','sort','\x20\x0a\x20','gemini-pro','Aguardando\x20resposta\x20da\x20OpenAI...\x20runStatus.status:\x20','fromMe','PLACEHOLDER_','model','env','replace','default','@sentry/node','value','undefined','set','Enviando\x20mensagens...','Resposta\x20Gemini:\x20',',\x20reiniciando\x20o\x20processamento.','sessionName','length','@wppconnect-team/wppconnect','trimEnd','SOMENTE_RESPONDER','getOwnPropertyNames','messages','19378lNhMfe','MENSAGEM_PARA_ENVIAR_QUANDO_RECEBER_TIPO_DESCONHECIDO','...','filter','2866500YQJaJE','create','_sentryDebugIds','before','get','GoogleGenerativeAI','stopTyping','retrieve','Novas\x20mensagens\x20detectadas\x20para\x20','from','HORAS_PARA_REATIVAR_IA','data','Aplicativo\x20inicializado\x20com\x20a\x20configuração\x20de\x20IA\x20selecionada:\x20','stack','@sentry/profiling-node','shift','getOwnPropertyDescriptor','body','\x20está\x20na\x20lista\x20de\x20excluídos.\x20Ignorando\x20mensagem.','info','onMessage','status','7096udeZNq','0c8a859f-e735-5f11-a215-40af494122e5','location','function','5435374HoKRFB','isGroupMsg','slice','beta','MENSAGEM_PARA_ENVIAR_QUANDO_RECEBER_AUDIO','find','startsWith','Erro\x20ao\x20verificar\x20o\x20status\x20do\x20run:','getPrototypeOf','6030OswXsa','7050660VqyDaK','type','Enviando\x20mensagem:\x20','GEMINI','response','completed','3470630gQeRGc','config','findLastIndex','\x20expirou\x20e\x20foi\x20removido.','@c.us','dotenv','has','assistants','trimStart','log','Erro\x20ao\x20enviar\x20mensagem:','enumerable','init','4XBnGGo','OPENAI_KEY','sendText','__esModule','join','Resposta\x20da\x20IA:\x20','startChat','split','OPENAI_ASSISTANT','getMessages','timestamp','runs','threads','chatId','catch','Audio\x20recebido','Número\x20','chat','list','map','role','Mensagem\x20recebida:','then','GEMINI_PROMPT','Imagem\x20recebida','nodeProfilingIntegration','reduce','78ZlGZkb','user','1500933qwmRSF','some','delete','instructions','AI_SELECTED','MENSAGEM_PARA_ENVIAR_QUANDO_RECEBER_IMAGEM','GEMINI_KEY','substring','parts','.\x20Mensagem\x20adicionada\x20ao\x20buffer.','text','Você\x20precisa\x20colocar\x20uma\x20key\x20do\x20Gemini\x20no\x20.env!','defineProperty','error','Mensagem\x20enviada:','Erro\x20ao\x20processar\x20mensagem:','SEGUNDOS_PARA_ESPERAR_ANTES_DE_GERAR_RESPOSTA','match','Terminal\x20qrcode:\x20','GPT','hasOwnProperty','captureException','image','Chat\x20'];a0_0xb2c3=function(){return _0x5cd573;};return a0_0xb2c3();}var genAI=new import_generative_ai[(a0_0x2947f7(0x179))](process[a0_0x2947f7(0x15f)][a0_0x2947f7(0x1ce)]),model=genAI['getGenerativeModel']({'model':a0_0x2947f7(0x15a)}),activeChats=new Map(),getOrCreateChatSession=async _0xb458d9=>{var _0x1e90ae=a0_0x2947f7;if(activeChats[_0x1e90ae(0x1a4)](_0xb458d9)){const _0x5b2b0f=activeChats[_0x1e90ae(0x178)](_0xb458d9);return model[_0x1e90ae(0x1b1)]({'history':_0x5b2b0f});}const _0x2840c9=[{'role':_0x1e90ae(0x1c7),'parts':process[_0x1e90ae(0x15f)][_0x1e90ae(0x1c2)]??'oi'},{'role':_0x1e90ae(0x15e),'parts':'Olá,\x20certo!'}];return activeChats['set'](_0xb458d9,_0x2840c9),setTimeout(()=>{var _0x5e8c15=_0x1e90ae;activeChats[_0x5e8c15(0x1a4)](_0xb458d9)&&(activeChats['delete'](_0xb458d9),console[_0x5e8c15(0x1a7)](_0x5e8c15(0x155)+_0xb458d9+_0x5e8c15(0x1a1)));},0x48*0x3c*0x3c*0x3e8),model[_0x1e90ae(0x1b1)]({'history':_0x2840c9});},mainGoogle=async({currentMessage:_0x5c7811,chatId:_0x857887})=>{var _0x4d558d=a0_0x2947f7;const _0x4c006c=await getOrCreateChatSession(_0x857887),_0x194e52=_0x5c7811,_0x4bda56=await _0x4c006c['sendMessage'](_0x194e52),_0xfa6240=_0x4bda56[_0x4d558d(0x19c)],_0x455c47=_0xfa6240[_0x4d558d(0x1d2)]();return activeChats['set'](_0x857887,[...activeChats[_0x4d558d(0x178)](_0x857887),{'role':'user','parts':_0x194e52},{'role':_0x4d558d(0x15e),'parts':_0x455c47}]),console['log'](_0x4d558d(0x167),_0x455c47),_0x455c47;},import_openai=__toESM(require(a0_0x2947f7(0x156)),0x1),import_dotenv2=__toESM(require(a0_0x2947f7(0x1a3)),0x1),import_node2=require(a0_0x2947f7(0x162));import_dotenv2['default'][a0_0x2947f7(0x19f)]();var assistant,openai,activeChats2=new Map();async function initializeNewAIChatSession(_0x74c1f8){var _0x3d8d19=a0_0x2947f7;openai=new import_openai['default']({'apiKey':process['env'][_0x3d8d19(0x1ac)]}),assistant=await openai[_0x3d8d19(0x191)][_0x3d8d19(0x1a5)]['retrieve'](process[_0x3d8d19(0x15f)][_0x3d8d19(0x1b3)]);if(activeChats2[_0x3d8d19(0x1a4)](_0x74c1f8))return;const _0x205fe1=await openai[_0x3d8d19(0x191)][_0x3d8d19(0x1b7)][_0x3d8d19(0x175)]();activeChats2['set'](_0x74c1f8,_0x205fe1),setTimeout(()=>{var _0x40dda9=_0x3d8d19;activeChats2['has'](_0x74c1f8)&&(activeChats2[_0x40dda9(0x1ca)](_0x74c1f8),console['log']('Chat\x20'+_0x74c1f8+_0x40dda9(0x1a1)));},0x48*0x3c*0x3c*0x3e8);}async function mainOpenAI({currentMessage:_0x2af325,chatId:_0x37ec77}){var _0x5303a1=a0_0x2947f7;const _0x2fee98=activeChats2[_0x5303a1(0x178)](_0x37ec77);await openai[_0x5303a1(0x191)][_0x5303a1(0x1b7)][_0x5303a1(0x16f)][_0x5303a1(0x175)](_0x2fee98['id'],{'role':_0x5303a1(0x1c7),'content':_0x2af325});const _0x59a030=await openai[_0x5303a1(0x191)]['threads'][_0x5303a1(0x1b6)][_0x5303a1(0x175)](_0x2fee98['id'],{'assistant_id':assistant['id'],'instructions':assistant[_0x5303a1(0x1cb)]}),_0x30f335=await checkRunStatus({'threadId':_0x2fee98['id'],'runId':_0x59a030['id']}),_0x5f0e0e=_0x30f335[_0x5303a1(0x17f)][0x0]['content'][0x0];return _0x5f0e0e[_0x5303a1(0x1d2)][_0x5303a1(0x163)];}async function checkRunStatus({threadId:_0x2d3228,runId:_0x5a5052}){return await new Promise((_0x13cb5e,_0xfc834f)=>{const _0x228a0c=async()=>{var _0x5c3983=a0_0x2ae1;try{const _0x4db6f1=await openai[_0x5c3983(0x191)][_0x5c3983(0x1b7)][_0x5c3983(0x1b6)][_0x5c3983(0x17b)](_0x2d3228,_0x5a5052);if(_0x4db6f1[_0x5c3983(0x189)]===_0x5c3983(0x19d)){const _0x4c834a=await openai[_0x5c3983(0x191)]['threads']['messages'][_0x5c3983(0x1bd)](_0x2d3228);_0x13cb5e(_0x4c834a);}else console[_0x5c3983(0x1a7)](_0x5c3983(0x15b),_0x4db6f1[_0x5c3983(0x189)]),setTimeout(_0x228a0c,0x1388);}catch(_0x493cc9){(0x0,import_node2[_0x5c3983(0x153)])(_0x493cc9),console[_0x5c3983(0x14b)](_0x5c3983(0x195),_0x493cc9),_0xfc834f(_0x493cc9);}};_0x228a0c();});}function formatPhoneNumber(_0x326474){var _0x199c94=a0_0x2947f7;let _0x1f01fe=_0x326474[_0x199c94(0x160)](/\D/g,'');if(_0x1f01fe==='')return'';return _0x1f01fe[_0x199c94(0x16a)]===0xd&&_0x1f01fe[_0x199c94(0x194)]('55')&&(_0x1f01fe=_0x1f01fe['slice'](0x0,0x4)+_0x1f01fe[_0x199c94(0x190)](0x5)),_0x1f01fe+_0x199c94(0x1a2);}function normalizePhoneNumber(_0x4ef5e7){var _0x9bb374=a0_0x2947f7;let _0x4ac23e=_0x4ef5e7[_0x9bb374(0x160)](/\D/g,'');return _0x4ac23e[_0x9bb374(0x194)]('55')&&(_0x4ac23e=_0x4ac23e['substring'](0x2),_0x4ac23e[_0x9bb374(0x16a)]===0xb&&(_0x4ac23e=_0x4ac23e['substring'](0x0,0x2)+_0x4ac23e[_0x9bb374(0x1cf)](0x3))),_0x4ac23e;}function isPhoneNumberMatch(_0x4a4522,_0x5ead21){const _0x3dadac=normalizePhoneNumber(_0x4a4522),_0x513a9b=normalizePhoneNumber(_0x5ead21);return _0x3dadac===_0x513a9b;}var allowedNumbersFormatted=process[a0_0x2947f7(0x15f)][a0_0x2947f7(0x16d)]?.['split'](',')[a0_0x2947f7(0x1be)](formatPhoneNumber)[a0_0x2947f7(0x173)](_0x1e521e=>_0x1e521e)??[],excludedNumbersFormatted=process[a0_0x2947f7(0x15f)]['NAO_RESPONDER']?.[a0_0x2947f7(0x1b2)](',')[a0_0x2947f7(0x1be)](formatPhoneNumber)[a0_0x2947f7(0x173)](_0x14414d=>_0x14414d)??[],isAllowedToProcess=(_0x456302,_0x4163b2)=>{var _0x680db7=a0_0x2947f7;if(_0x4163b2[_0x680db7(0x1a4)](_0x456302))return console[_0x680db7(0x1a7)](_0x680db7(0x1bb)+_0x456302+'\x20não\x20será\x20respondido\x20devido\x20a\x20intervenção\x20humana.'),![];if(excludedNumbersFormatted[_0x680db7(0x1c9)](_0x2a12b2=>isPhoneNumberMatch(_0x456302,_0x2a12b2)))return console[_0x680db7(0x1a7)]('Número\x20'+_0x456302+_0x680db7(0x186)),![];if(allowedNumbersFormatted[_0x680db7(0x16a)]>0x0&&!allowedNumbersFormatted[_0x680db7(0x1c9)](_0xc0f7f7=>isPhoneNumberMatch(_0x456302,_0xc0f7f7)))return console['log'](_0x680db7(0x1bb)+_0x456302+'\x20não\x20está\x20na\x20lista\x20de\x20permitidos.\x20Ignorando\x20mensagem.'),![];return!![];},import_node3=require(a0_0x2947f7(0x162)),AI_SELECTED=process[a0_0x2947f7(0x15f)][a0_0x2947f7(0x1cc)]||'GEMINI',messageBufferPerChatId=new Map(),messageTimeouts=new Map(),processingStates=new Map(),lastSentMessageWarningByChatId=new Map(),MAX_RETRIES=0x3,activeChatsHistory=new Map(),excludedNumbersIntervention=new Map();function a0_0x2ae1(_0x2ce630,_0x35bbb5){var _0xb2c315=a0_0xb2c3();return a0_0x2ae1=function(_0x2ae11b,_0x1d49c3){_0x2ae11b=_0x2ae11b-0x149;var _0x93d61f=_0xb2c315[_0x2ae11b];return _0x93d61f;},a0_0x2ae1(_0x2ce630,_0x35bbb5);}async function processMessage(_0x11ced2,_0xac41ec){var _0x46d041=a0_0x2947f7;const _0x62ec77=_0xac41ec['chatId'];console['log'](_0x46d041(0x1c0),_0xac41ec[_0x46d041(0x185)]);if(!isAllowedToProcess(_0x62ec77,excludedNumbersIntervention))return;if(_0xac41ec[_0x46d041(0x199)]===_0x46d041(0x154)){console[_0x46d041(0x1a7)](_0x46d041(0x1c3)),await sendTextOnce({'client':_0x11ced2,'chatId':_0xac41ec['from'],'message':process[_0x46d041(0x15f)][_0x46d041(0x1cd)],'lastSentMessageWarningByChatId':lastSentMessageWarningByChatId}),registerMessageOnHistory({'activeChatsHistory':activeChatsHistory,'chatId':_0x62ec77,'message':process[_0x46d041(0x15f)][_0x46d041(0x1cd)]});return;}if(_0xac41ec[_0x46d041(0x199)]==='ptt'||_0xac41ec[_0x46d041(0x199)]==='audio'){console[_0x46d041(0x1a7)](_0x46d041(0x1ba)),await sendTextOnce({'client':_0x11ced2,'chatId':_0xac41ec[_0x46d041(0x17d)],'message':process[_0x46d041(0x15f)][_0x46d041(0x192)],'lastSentMessageWarningByChatId':lastSentMessageWarningByChatId}),registerMessageOnHistory({'activeChatsHistory':activeChatsHistory,'chatId':_0x62ec77,'message':process[_0x46d041(0x15f)][_0x46d041(0x192)]});return;}if(_0xac41ec[_0x46d041(0x199)]==='document'||_0xac41ec[_0x46d041(0x199)]===_0x46d041(0x18c)){console['log']('Documento\x20ou\x20localização\x20recebida'),await sendTextOnce({'client':_0x11ced2,'chatId':_0xac41ec['from'],'message':process['env'][_0x46d041(0x171)],'lastSentMessageWarningByChatId':lastSentMessageWarningByChatId}),registerMessageOnHistory({'activeChatsHistory':activeChatsHistory,'chatId':_0x62ec77,'message':process[_0x46d041(0x15f)][_0x46d041(0x171)]});return;}if(_0xac41ec[_0x46d041(0x199)]!==_0x46d041(0x1bc))return;const _0x1e6872=activeChatsHistory[_0x46d041(0x178)](_0x62ec77);if(_0x1e6872){const _0x1c2976=await _0x11ced2[_0x46d041(0x1b4)](_0x62ec77,{'count':0x14,'direction':_0x46d041(0x177),'fromMe':!![]}),_0x283291=await isMissingMessages({'chatId':_0x62ec77,'activeChatsHistory':activeChatsHistory,'lastMessages':_0x1c2976});if(_0x283291){console['log'](_0x46d041(0x157)+_0x62ec77+_0x46d041(0x172)),excludedNumbersIntervention[_0x46d041(0x165)](_0x62ec77,!![]),setTimeout(()=>{var _0x1ebe7a=_0x46d041;excludedNumbersIntervention[_0x1ebe7a(0x1a4)](_0x62ec77)&&excludedNumbersIntervention[_0x1ebe7a(0x1ca)](_0x62ec77);},Number(process[_0x46d041(0x15f)][_0x46d041(0x17e)])*0x3c*0x3c*0x3e8);return;}}AI_SELECTED===_0x46d041(0x151)&&await initializeNewAIChatSession(_0x62ec77);!messageBufferPerChatId[_0x46d041(0x1a4)](_0x62ec77)?messageBufferPerChatId[_0x46d041(0x165)](_0x62ec77,[_0xac41ec[_0x46d041(0x185)]]):messageBufferPerChatId[_0x46d041(0x165)](_0x62ec77,[...messageBufferPerChatId[_0x46d041(0x178)](_0x62ec77),_0xac41ec[_0x46d041(0x185)]]);if(processingStates['get'](_0x62ec77)){console[_0x46d041(0x1a7)]('Processamento\x20em\x20andamento\x20para\x20'+_0x62ec77+_0x46d041(0x1d1));return;}messageTimeouts[_0x46d041(0x1a4)](_0x62ec77)&&clearTimeout(messageTimeouts[_0x46d041(0x178)](_0x62ec77)),console['log']('Aguardando\x20novas\x20mensagens\x20de\x20'+_0x62ec77+'...'),messageTimeouts[_0x46d041(0x165)](_0x62ec77,setTimeout(()=>{((async()=>{var _0x33f923=a0_0x2ae1;processingStates[_0x33f923(0x165)](_0x62ec77,!![]),messageBufferPerChatId['delete'](_0x62ec77);const _0x569b68=!messageBufferPerChatId['has'](_0x62ec77)?_0xac41ec[_0x33f923(0x185)]:[...messageBufferPerChatId[_0x33f923(0x178)](_0x62ec77)][_0x33f923(0x1af)](_0x33f923(0x159));let _0x2b7488='',_0xbfc449=![];for(let _0x4a2745=0x1;_0x4a2745<=MAX_RETRIES;_0x4a2745++){try{AI_SELECTED===_0x33f923(0x151)?_0x2b7488=await mainOpenAI({'currentMessage':_0x569b68,'chatId':_0x62ec77}):_0x2b7488=await mainGoogle({'currentMessage':_0x569b68,'chatId':_0x62ec77});_0xbfc449=!![];break;}catch(_0xfc1fbf){(0x0,import_node3['captureException'])(_0xfc1fbf);if(_0x4a2745===MAX_RETRIES)throw _0xfc1fbf;}finally{_0xbfc449&&(processingStates[_0x33f923(0x165)](_0x62ec77,![]),messageBufferPerChatId[_0x33f923(0x178)](_0x62ec77)?.[_0x33f923(0x16a)]&&(console[_0x33f923(0x1a7)](_0x33f923(0x17c)+_0x62ec77+_0x33f923(0x168)),setImmediate(async()=>{var _0x35dbdb=_0x33f923;const _0x4dd2af=messageBufferPerChatId[_0x35dbdb(0x178)](_0x62ec77)[_0x35dbdb(0x1be)](_0xe4df29=>({'body':_0xe4df29,'type':_0x35dbdb(0x1bc),'chatId':_0x62ec77}));messageBufferPerChatId[_0x35dbdb(0x1ca)](_0x62ec77),console['log']({'bufferedMessages':_0x4dd2af});for(const _0x4a4d70 of _0x4dd2af){console[_0x35dbdb(0x1a7)]({'message':_0x4a4d70}),await processMessage(_0x11ced2,_0x4a4d70);}})),messageTimeouts['delete'](_0x62ec77));}}console['log'](_0x33f923(0x1b0),_0x2b7488);const _0x4b30aa=splitMessages(_0x2b7488);console[_0x33f923(0x1a7)](_0x33f923(0x166)),await sendMessagesWithDelay({'client':_0x11ced2,'messages':_0x4b30aa,'targetNumber':_0xac41ec['chatId'],'activeChatsHistory':activeChatsHistory,'currentMessage':_0x569b68,'excludedNumbersIntervention':excludedNumbersIntervention});})());},Number(process[_0x46d041(0x15f)][_0x46d041(0x14e)])*0x3e8));}var import_node4=require(a0_0x2947f7(0x162)),initWhatsAppClient=()=>{var _0x11e776=a0_0x2947f7;import_wppconnect[_0x11e776(0x161)][_0x11e776(0x175)]({'session':_0x11e776(0x169),'catchQR':(_0x5732b7,_0x7eb9b5,_0xb86cc9,_0x5bc47e)=>{var _0x2c38af=_0x11e776;console[_0x2c38af(0x187)](_0x2c38af(0x150),_0x7eb9b5);},'headless':!![]})[_0x11e776(0x1c1)](_0x43bbfc=>{var _0x2ba05f=_0x11e776;_0x43bbfc[_0x2ba05f(0x188)](async _0x55f669=>{var _0x7547aa=_0x2ba05f;if(!isValidMessage(_0x55f669))return;try{await processMessage(_0x43bbfc,_0x55f669);}catch(_0x48525d){console['error'](_0x7547aa(0x14d),_0x48525d),(0x0,import_node4[_0x7547aa(0x153)])(_0x48525d);}});})['catch'](_0x29bfb7=>{var _0x2defa8=_0x11e776;console[_0x2defa8(0x1a7)](_0x29bfb7),(0x0,import_node4['captureException'])(_0x29bfb7);});},config={'AI_SELECTED':process[a0_0x2947f7(0x15f)][a0_0x2947f7(0x1cc)]||'GEMINI','GEMINI_KEY':process[a0_0x2947f7(0x15f)][a0_0x2947f7(0x1ce)],'OPENAI_KEY':process[a0_0x2947f7(0x15f)][a0_0x2947f7(0x1ac)],'OPENAI_ASSISTANT':process[a0_0x2947f7(0x15f)][a0_0x2947f7(0x1b3)]},validateConfig=()=>{var _0x342d50=a0_0x2947f7;if(config[_0x342d50(0x1cc)]===_0x342d50(0x19b)&&!config['GEMINI_KEY'])throw Error(_0x342d50(0x149));if(config['AI_SELECTED']===_0x342d50(0x151)&&(!config[_0x342d50(0x1ac)]||!config[_0x342d50(0x1b3)]))throw Error('Para\x20utilizar\x20o\x20GPT\x20você\x20precisa\x20configurar\x20a\x20sua\x20key\x20da\x20OpenAI\x20e\x20o\x20id\x20do\x20seu\x20assistente\x20no\x20.env.');},import_dotenv3=__toESM(require('dotenv'),0x1),import_node5=__toESM(require(a0_0x2947f7(0x162)),0x1),import_profiling_node=require(a0_0x2947f7(0x182));import_dotenv3[a0_0x2947f7(0x161)][a0_0x2947f7(0x19f)](),import_node5['default'][a0_0x2947f7(0x1aa)]({'dsn':'https://ccb14e5677b081c7128a1ee2e9b38325@o4506956743114752.ingest.us.sentry.io/4506956746522624','integrations':[(0x0,import_profiling_node[a0_0x2947f7(0x1c4)])()],'tracesSampleRate':0x1,'profilesSampleRate':0x1}),validateConfig(),initWhatsAppClient(),console[a0_0x2947f7(0x1a7)](a0_0x2947f7(0x180)+config[a0_0x2947f7(0x1cc)]),!(function(){var _0x3ac9c2=a0_0x2947f7;try{var _0x4f8849=_0x3ac9c2(0x164)!=typeof window?window:'undefined'!=typeof global?global:'undefined'!=typeof self?self:{},_0x48e3c7=new Error()[_0x3ac9c2(0x181)];_0x48e3c7&&(_0x4f8849['_sentryDebugIds']=_0x4f8849[_0x3ac9c2(0x176)]||{},_0x4f8849['_sentryDebugIds'][_0x48e3c7]=_0x3ac9c2(0x18b));}catch(_0xc21c9){}}());